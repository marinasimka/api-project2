<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API –ê–¥—Ä–µ—Å–æ–≤ - –†–∞–±–æ—Ç–∞–µ—Ç!</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 1000px; margin: auto; background: #f5f5f5; }
        .header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .success-badge { background: #4CAF50; color: white; padding: 5px 10px; border-radius: 20px; display: inline-block; }
        .section { background: white; padding: 20px; border-radius: 10px; margin: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { background: #2196F3; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { opacity: 0.9; }
        button.get { background: #4CAF50; }
        button.post { background: #FF9800; }
        button.put { background: #9C27B0; }
        button.delete { background: #F44336; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f2f2f2; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow: auto; max-height: 300px; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        textarea { height: 80px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="header">
        <h1> REST API –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤ - –†–ê–ë–û–¢–ê–ï–¢!</h1>
        <span class="success-badge">–í–°–ï –°–ò–°–¢–ï–ú–´ –í –ù–û–†–ú–ï</span>
        <p>API —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ MySQL –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
    </div>
    
    <div class="section">
        <h2> –¢–µ–∫—É—â–∏–µ –∞–¥—Ä–µ—Å–∞ –≤ –±–∞–∑–µ (5 –∑–∞–ø–∏—Å–µ–π)</h2>
        <button class="get" onclick="getAll()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        <div id="addressesTable"></div>
    </div>
    
    <div class="section">
        <h2> –ù–∞–π—Ç–∏ –∞–¥—Ä–µ—Å –ø–æ ID</h2>
        <input type="number" id="searchId" value="1" placeholder="–í–≤–µ–¥–∏—Ç–µ ID">
        <button class="get" onclick="getById()">–ù–∞–π—Ç–∏</button>
        <div id="singleResult"></div>
    </div>
    
    <div class="section">
        <h2> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å (POST)</h2>
        <input type="number" id="newUserId" value="1" placeholder="User ID">
        <input type="text" id="newStreet" placeholder="–£–ª–∏—Ü–∞" value="–ù–æ–≤–∞—è —É–ª–∏—Ü–∞">
        <input type="text" id="newCity" placeholder="–ì–æ—Ä–æ–¥" value="–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥">
        <input type="text" id="newZip" placeholder="–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å" value="123456">
        <button class="post" onclick="createAddress()">–°–æ–∑–¥–∞—Ç—å –∞–¥—Ä–µ—Å</button>
        <div id="createResult"></div>
    </div>
    
    <div class="section">
        <h2> –û–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å (PUT)</h2>
        <input type="number" id="updateId" value="1" placeholder="ID –∞–¥—Ä–µ—Å–∞">
        <input type="text" id="updateStreet" placeholder="–ù–æ–≤–∞—è —É–ª–∏—Ü–∞" value="–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —É–ª–∏—Ü–∞">
        <input type="text" id="updateCity" placeholder="–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥" value="–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≥–æ—Ä–æ–¥">
        <input type="text" id="updateZip" placeholder="–ù–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å" value="999999">
        <button class="put" onclick="updateAddress()">–û–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å</button>
        <div id="updateResult"></div>
    </div>
    
    <div class="section">
        <h2> –£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å (DELETE)</h2>
        <input type="number" id="deleteId" value="5" placeholder="ID –∞–¥—Ä–µ—Å–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è">
        <button class="delete" onclick="deleteAddress()">–£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å</button>
        <div id="deleteResult"></div>
    </div>

    <script>
        const API_KEY = '$2y$10$EKNJanRosYtQWp0TlUv0PeBsBnTwikCQ9IP0psIWkk7071rh0PhXC';
        
        async function apiRequest(endpoint, method = 'GET', data = null) {
            const url = 'index.php?url=' + endpoint;
            const options = {
                method: method,
                headers: {
                    'X-API-Key': API_KEY,
                    'Content-Type': 'application/json'
                }
            };
            if (data) options.body = JSON.stringify(data);
            
            try {
                const response = await fetch(url, options);
                return await response.json();
            } catch (error) {
                return { success: false, message: 'Network error: ' + error.message };
            }
        }
        
        async function getAll() {
            const result = await apiRequest('addresses');
            if (result.success) {
                let table = '<table><tr><th>ID</th><th>User ID</th><th>–£–ª–∏—Ü–∞</th><th>–ì–æ—Ä–æ–¥</th><th>–ò–Ω–¥–µ–∫—Å</th><th>–°–æ–∑–¥–∞–Ω</th></tr>';
                result.data.forEach(addr => {
                    table += `<tr>
                        <td>${addr.id}</td>
                        <td>${addr.user_id}</td>
                        <td>${addr.street}</td>
                        <td>${addr.city}</td>
                        <td>${addr.zip_code}</td>
                        <td>${addr.created_at}</td>
                    </tr>`;
                });
                table += '</table>';
                document.getElementById('addressesTable').innerHTML = table;
            }
        }
        
        async function getById() {
            const id = document.getElementById('searchId').value;
            const result = await apiRequest('addresses/' + id);
            const container = document.getElementById('singleResult');
            
            if (result.success) {
                container.innerHTML = `
                    <div style="background:#e8f5e9; padding:10px; border-radius:5px;">
                        <h3> –ù–∞–π–¥–µ–Ω –∞–¥—Ä–µ—Å ID: ${id}</h3>
                        <p><strong>–£–ª–∏—Ü–∞:</strong> ${result.data.street}</p>
                        <p><strong>–ì–æ—Ä–æ–¥:</strong> ${result.data.city}</p>
                        <p><strong>–ò–Ω–¥–µ–∫—Å:</strong> ${result.data.zip_code}</p>
                        <p><strong>–°–æ–∑–¥–∞–Ω:</strong> ${result.data.created_at}</p>
                    </div>
                `;
            } else {
                container.innerHTML = `<div style="background:#ffebee; padding:10px; border-radius:5px; color:#c62828;">‚ùå ${result.message}</div>`;
            }
        }
        
        async function createAddress() {
            const data = {
                user_id: document.getElementById('newUserId').value,
                street: document.getElementById('newStreet').value,
                city: document.getElementById('newCity').value,
                zip_code: document.getElementById('newZip').value
            };
            
            const result = await apiRequest('addresses', 'POST', data);
            const container = document.getElementById('createResult');
            
            if (result.success) {
                container.innerHTML = `<div style="background:#e8f5e9; padding:10px; border-radius:5px;"> ${result.message}<br>ID –Ω–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞: ${result.data.id}</div>`;
                getAll(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            } else {
                container.innerHTML = `<div style="background:#ffebee; padding:10px; border-radius:5px; color:#c62828;"> ${result.message}</div>`;
            }
        }
        
        async function updateAddress() {
            const id = document.getElementById('updateId').value;
            const data = {
                street: document.getElementById('updateStreet').value,
                city: document.getElementById('updateCity').value,
                zip_code: document.getElementById('updateZip').value
            };
            
            const result = await apiRequest('addresses/' + id, 'PUT', data);
            const container = document.getElementById('updateResult');
            
            container.innerHTML = result.success 
                ? `<div style="background:#e8f5e9; padding:10px; border-radius:5px;"> ${result.message}</div>`
                : `<div style="background:#ffebee; padding:10px; border-radius:5px; color:#c62828;"> ${result.message}</div>`;
            
            getAll(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        }
        
        async function deleteAddress() {
            const id = document.getElementById('deleteId').value;
            const result = await apiRequest('addresses/' + id, 'DELETE');
            const container = document.getElementById('deleteResult');
            
            container.innerHTML = result.success 
                ? `<div style="background:#e8f5e9; padding:10px; border-radius:5px;"> ${result.message}</div>`
                : `<div style="background:#ffebee; padding:10px; border-radius:5px; color:#c62828;"> ${result.message}</div>`;
            
            getAll(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        getAll();
    </script>
</body>
</html>